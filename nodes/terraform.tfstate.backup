{
    "version": 1,
    "serial": 5,
    "modules": [
        {
            "path": [
                "root"
            ],
            "outputs": {},
            "resources": {
                "cloudstack_instance.kube-worker": {
                    "type": "cloudstack_instance",
                    "depends_on": [
                        "cloudstack_network.network",
                        "template_file.node-config"
                    ],
                    "primary": {
                        "id": "e607fd63-7662-4ae6-8bf6-e57b61068e7f",
                        "attributes": {
                            "display_name": "master2k8s-worker1",
                            "expunge": "true",
                            "group": "",
                            "id": "e607fd63-7662-4ae6-8bf6-e57b61068e7f",
                            "ip_address": "10.100.0.46",
                            "keypair": "deployment",
                            "name": "master2k8s-worker1",
                            "network": "26dcc7bc-92c4-40fd-8eb7-f134773a2fbe",
                            "network_id": "26dcc7bc-92c4-40fd-8eb7-f134773a2fbe",
                            "project": "",
                            "service_offering": "MCC_v2.2vCPU.8GB.SBP1",
                            "template": "Coreos-beta-x86_64-Community-KVM-latest",
                            "user_data": "626bf788088a5658c189a1512ed05603995c9528",
                            "zone": "NL2"
                        }
                    },
                    "provider": "cloudstack.nl2"
                },
                "cloudstack_network.network": {
                    "type": "cloudstack_network",
                    "depends_on": [
                        "cloudstack_network_acl.acl",
                        "cloudstack_vpc.vpc"
                    ],
                    "primary": {
                        "id": "26dcc7bc-92c4-40fd-8eb7-f134773a2fbe",
                        "attributes": {
                            "acl_id": "952c79a7-b898-4abd-a4e1-446e208a13cc",
                            "cidr": "10.100.0.0/26",
                            "display_text": "k8s_master21",
                            "gateway": "10.100.0.1",
                            "id": "26dcc7bc-92c4-40fd-8eb7-f134773a2fbe",
                            "name": "SBP_NET_master21",
                            "network_offering": "MCC-VPC-LB",
                            "project": "",
                            "tags.#": "0",
                            "vpc_id": "c84c0933-273c-4363-97d3-2689fc99b62d",
                            "zone": "NL2"
                        }
                    },
                    "provider": "cloudstack.nl2"
                },
                "cloudstack_network_acl.acl": {
                    "type": "cloudstack_network_acl",
                    "depends_on": [
                        "cloudstack_vpc.vpc"
                    ],
                    "primary": {
                        "id": "952c79a7-b898-4abd-a4e1-446e208a13cc",
                        "attributes": {
                            "description": "k8s_master2-acl-1",
                            "id": "952c79a7-b898-4abd-a4e1-446e208a13cc",
                            "name": "k8s_master2-acl-1",
                            "vpc_id": "c84c0933-273c-4363-97d3-2689fc99b62d"
                        }
                    },
                    "provider": "cloudstack.nl2"
                },
                "cloudstack_network_acl_rule.acl-rule": {
                    "type": "cloudstack_network_acl_rule",
                    "depends_on": [
                        "cloudstack_network_acl.acl"
                    ],
                    "primary": {
                        "id": "952c79a7-b898-4abd-a4e1-446e208a13cc",
                        "attributes": {
                            "acl_id": "952c79a7-b898-4abd-a4e1-446e208a13cc",
                            "id": "952c79a7-b898-4abd-a4e1-446e208a13cc",
                            "managed": "false",
                            "parallelism": "2",
                            "rule.#": "1",
                            "rule.64791063.action": "allow",
                            "rule.64791063.cidr_list.#": "0",
                            "rule.64791063.icmp_code": "0",
                            "rule.64791063.icmp_type": "0",
                            "rule.64791063.ports.#": "0",
                            "rule.64791063.protocol": "all",
                            "rule.64791063.source_cidr": "85.222.238.59/32",
                            "rule.64791063.traffic_type": "ingress",
                            "rule.64791063.uuids.#": "1",
                            "rule.64791063.uuids.all": "8ad389ee-0138-4c91-8b67-cd9f52960c78"
                        }
                    },
                    "provider": "cloudstack.nl2"
                },
                "cloudstack_vpc.vpc": {
                    "type": "cloudstack_vpc",
                    "primary": {
                        "id": "c84c0933-273c-4363-97d3-2689fc99b62d",
                        "attributes": {
                            "cidr": "10.100.0.0/24",
                            "display_text": "SBP_VPC_master21",
                            "id": "c84c0933-273c-4363-97d3-2689fc99b62d",
                            "name": "SBP_VPC_master21",
                            "network_domain": "cs7ecloud.local",
                            "project": "",
                            "source_nat_ip": "85.222.238.108",
                            "vpc_offering": "MCC-KVM-VPC-SBP1",
                            "zone": "NL2"
                        }
                    },
                    "provider": "cloudstack.nl2"
                },
                "template_file.node-config": {
                    "type": "template_file",
                    "primary": {
                        "id": "73324a66a1efacd2b63f6ffa57c63a3b02c9ae8f8cdfa6b3fc9666286c865534",
                        "attributes": {
                            "id": "73324a66a1efacd2b63f6ffa57c63a3b02c9ae8f8cdfa6b3fc9666286c865534",
                            "rendered": "#cloud-config\n\n---\nwrite-files:\n  - path: /opt/bin/wupiao\n    permissions: '0755'\n    content: |\n      #!/bin/bash\n      # [w]ait [u]ntil [p]ort [i]s [a]ctually [o]pen\n      [ -n \"$1\" ] \u0026\u0026 [ -n \"$2\" ] \u0026\u0026 while ! curl --output /dev/null \\\n        --silent --head --fail \\\n        http://${1}:${2}; do sleep 1 \u0026\u0026 echo -n .; done;\n      exit $?\n  - path: /etc/hosts\n    permissions: 0755\n    content: |\n      85.222.236.236 registry.services.schubergphilis.com\n  - path: /opt/kubeconfig\n    permissions: 0755\n    content: |\n      apiVersion: v1\n      kind: Config\n      clusters:\n      - cluster:\n          server: https://85.222.238.107:6443\n          insecure-skip-tls-verify: true\n        name: kubernetes\n      contexts:\n      - context:\n          cluster: kubernetes\n          user: kubelet\n        name: kubelet\n      current-context: kubelet\n      users:\n        - name: kubelet\n          user:\n            token: kubelet\ncoreos:\n  etcd2:\n    advertise-client-urls: http://127.0.0.1:2379\n    listen-client-urls: http://127.0.0.1:2379\n  units:\n    - name: docker.service\n      command: start\n    - name: flanneld.service\n      command: start\n      drop-ins:\n        - name: 50-network-config.conf\n          content: |\n            [Unit]\n            Requires=etcd2.service\n            [Service]\n            ExecStartPre=/usr/bin/etcdctl set /coreos.com/network/config '{\"Network\":\"10.193.0.0/16\", \"Backend\": {\"Type\": \"vxlan\"}}'\n    - name: setup-network-environment.service\n      command: start\n      content: |\n        [Unit]\n        Description=Setup Network Environment\n        Documentation=https://github.com/kelseyhightower/setup-network-environment\n        Requires=network-online.target\n        After=network-online.target\n\n        [Service]\n        ExecStartPre=-/usr/bin/mkdir -p /opt/bin\n        ExecStartPre=/usr/bin/curl -L -o /opt/bin/setup-network-environment -z /opt/bin/setup-network-environment https://github.com/kelseyhightower/setup-network-environment/releases/download/v1.0.0/setup-network-environment\n        ExecStartPre=/usr/bin/chmod +x /opt/bin/setup-network-environment\n        ExecStart=/opt/bin/setup-network-environment\n        RemainAfterExit=yes\n        Type=oneshot\n    - name: kube-proxy.service\n      command: start\n      content: |\n        [Unit]\n        Description=Kubernetes Proxy\n        Documentation=https://github.com/kubernetes/kubernetes\n        Requires=setup-network-environment.service\n        After=setup-network-environment.service\n\n        [Service]\n        ExecStartPre=/usr/bin/curl -L -o /opt/bin/kube-proxy -z /opt/bin/kube-proxy https://storage.googleapis.com/kubernetes-release/release/v1.3.0/bin/linux/amd64/kube-proxy\n        ExecStartPre=/usr/bin/chmod +x /opt/bin/kube-proxy\n        # wait for kubernetes master to be up and ready\n        ExecStart=/opt/bin/kube-proxy \\\n        --kubeconfig=/opt/kubeconfig \\\n        --v=2 \\\n        --logtostderr=true\n        Restart=always\n        RestartSec=10\n    - name: kube-kubelet.service\n      command: start\n      content: |\n        [Unit]\n        Description=Kubernetes Kubelet\n        Documentation=https://github.com/kubernetes/kubernetes\n        Requires=setup-network-environment.service\n        After=setup-network-environment.service\n\n        [Service]\n        EnvironmentFile=/etc/network-environment\n        ExecStartPre=/usr/bin/curl -L -o /opt/bin/kubelet -z /opt/bin/kubelet https://storage.googleapis.com/kubernetes-release/release/v1.3.0/bin/linux/amd64/kubelet\n        ExecStartPre=/usr/bin/chmod +x /opt/bin/kubelet\n        # wait for kubernetes master to be up and ready\n        ExecStart=/opt/bin/kubelet \\\n        --address=0.0.0.0 \\\n        --port=10250 \\\n        --hostname-override=${DEFAULT_IPV4} \\\n        --api-servers=https://85.222.238.107:6443 \\\n        --allow-privileged=true \\\n        --logtostderr=true \\\n        --kubeconfig=/opt/kubeconfig \\\n        --cluster-dns=10.100.0.2 \\\n        --cluster-domain=cluster.local \\\n        --cadvisor-port=4194 \\\n        --healthz-bind-address=0.0.0.0 \\\n        --healthz-port=10248 \\\n        --v=2\n        Restart=always\n        RestartSec=10\n  update:\n    group: beta\n    reboot-strategy: off\n",
                            "template": "#cloud-config\n\n---\nwrite-files:\n  - path: /opt/bin/wupiao\n    permissions: '0755'\n    content: |\n      #!/bin/bash\n      # [w]ait [u]ntil [p]ort [i]s [a]ctually [o]pen\n      [ -n \"$1\" ] \u0026\u0026 [ -n \"$2\" ] \u0026\u0026 while ! curl --output /dev/null \\\n        --silent --head --fail \\\n        http://$${1}:$${2}; do sleep 1 \u0026\u0026 echo -n .; done;\n      exit $?\n  - path: /etc/hosts\n    permissions: 0755\n    content: |\n      85.222.236.236 registry.services.schubergphilis.com\n  - path: /opt/kubeconfig\n    permissions: 0755\n    content: |\n      apiVersion: v1\n      kind: Config\n      clusters:\n      - cluster:\n          server: ${master_url}\n          insecure-skip-tls-verify: true\n        name: kubernetes\n      contexts:\n      - context:\n          cluster: kubernetes\n          user: kubelet\n        name: kubelet\n      current-context: kubelet\n      users:\n        - name: kubelet\n          user:\n            token: kubelet\ncoreos:\n  etcd2:\n    advertise-client-urls: http://127.0.0.1:2379\n    listen-client-urls: http://127.0.0.1:2379\n  units:\n    - name: docker.service\n      command: start\n    - name: flanneld.service\n      command: start\n      drop-ins:\n        - name: 50-network-config.conf\n          content: |\n            [Unit]\n            Requires=etcd2.service\n            [Service]\n            ExecStartPre=/usr/bin/etcdctl set /coreos.com/network/config '{\"Network\":\"10.193.0.0/16\", \"Backend\": {\"Type\": \"vxlan\"}}'\n    - name: setup-network-environment.service\n      command: start\n      content: |\n        [Unit]\n        Description=Setup Network Environment\n        Documentation=https://github.com/kelseyhightower/setup-network-environment\n        Requires=network-online.target\n        After=network-online.target\n\n        [Service]\n        ExecStartPre=-/usr/bin/mkdir -p /opt/bin\n        ExecStartPre=/usr/bin/curl -L -o /opt/bin/setup-network-environment -z /opt/bin/setup-network-environment https://github.com/kelseyhightower/setup-network-environment/releases/download/v1.0.0/setup-network-environment\n        ExecStartPre=/usr/bin/chmod +x /opt/bin/setup-network-environment\n        ExecStart=/opt/bin/setup-network-environment\n        RemainAfterExit=yes\n        Type=oneshot\n    - name: kube-proxy.service\n      command: start\n      content: |\n        [Unit]\n        Description=Kubernetes Proxy\n        Documentation=https://github.com/kubernetes/kubernetes\n        Requires=setup-network-environment.service\n        After=setup-network-environment.service\n\n        [Service]\n        ExecStartPre=/usr/bin/curl -L -o /opt/bin/kube-proxy -z /opt/bin/kube-proxy https://storage.googleapis.com/kubernetes-release/release/v1.3.0/bin/linux/amd64/kube-proxy\n        ExecStartPre=/usr/bin/chmod +x /opt/bin/kube-proxy\n        # wait for kubernetes master to be up and ready\n        ExecStart=/opt/bin/kube-proxy \\\n        --kubeconfig=/opt/kubeconfig \\\n        --v=2 \\\n        --logtostderr=true\n        Restart=always\n        RestartSec=10\n    - name: kube-kubelet.service\n      command: start\n      content: |\n        [Unit]\n        Description=Kubernetes Kubelet\n        Documentation=https://github.com/kubernetes/kubernetes\n        Requires=setup-network-environment.service\n        After=setup-network-environment.service\n\n        [Service]\n        EnvironmentFile=/etc/network-environment\n        ExecStartPre=/usr/bin/curl -L -o /opt/bin/kubelet -z /opt/bin/kubelet https://storage.googleapis.com/kubernetes-release/release/v1.3.0/bin/linux/amd64/kubelet\n        ExecStartPre=/usr/bin/chmod +x /opt/bin/kubelet\n        # wait for kubernetes master to be up and ready\n        ExecStart=/opt/bin/kubelet \\\n        --address=0.0.0.0 \\\n        --port=10250 \\\n        --hostname-override=$${DEFAULT_IPV4} \\\n        --api-servers=${master_url} \\\n        --allow-privileged=true \\\n        --logtostderr=true \\\n        --kubeconfig=/opt/kubeconfig \\\n        --cluster-dns=10.100.0.2 \\\n        --cluster-domain=cluster.local \\\n        --cadvisor-port=4194 \\\n        --healthz-bind-address=0.0.0.0 \\\n        --healthz-port=10248 \\\n        --v=2\n        Restart=always\n        RestartSec=10\n  update:\n    group: beta\n    reboot-strategy: off\n",
                            "vars.#": "2",
                            "vars.clustername": "master2",
                            "vars.master_url": "https://85.222.238.107:6443"
                        }
                    }
                }
            }
        }
    ]
}
